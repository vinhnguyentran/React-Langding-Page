function _CPA(e){var t=this;document.location.host.split(".");t._domain=document.location.host,0<=t._domain.indexOf("vccloud.vn")&&(t._domain=".vccloud.vn"),t.getItemId(document.location.pathname),void 0===(e=void 0===e?{}:e).rtg_id&&(e.rtg_id=0),t.cpabd_param=e,t.cpabd_logged=!1}window.ADS_CPA_CHECKER={cpa:!0,cookies:{tid:"__tid",tp:"__tpn",iid:"__iid",src:"__src",su:"__su",st:"__st",v:"__v",sv:"__sv",domain:"__d",utm:"__utm"}},window.ADS_CPA_DOMAIN_DEFAULT="lg1.logging.admicro.vn",window.ADS_CPA_DOMAINS={"lg1.logging.admicro.vn":"contineljs.com"},_CPA.prototype.getRandom=function(){return Math.floor(1e3*Math.random()+1)},_CPA.prototype.isFirefox=function(){return 0<=window.navigator.userAgent.indexOf("Firefox")},_CPA.prototype.getItemId=function(e){var t=this,o=null;return null==e||"/"==e||("www.lazada.vn"===t._domain&&document.getElementById("pdtsku")&&(o=(o=document.getElementById("pdtsku").innerHTML).replace(/[\r\n]+/g,"")),null!=o&&""!=o&&t.setCookie(window.ADS_CPA_CHECKER.cookies.v,o,30,t._domain)),o},_CPA.prototype.parseUTMCookie=function(){var e={},t=this.getCookie("__utm");if(t){var o=t.split("|");for(i=0;i<o.length;i++){var a=o[i].split("=");e[a[0]]=a[1]}}return{source:void 0!==e.source?e.source:"",medium:void 0!==e.medium?e.medium:"",campaign:void 0!==e.campaign?e.campaign:"",content:void 0!==e.content?e.content:""}},_CPA.prototype.setValue=function(e,t){var o=this;return o.cpabd_param.v=e+"###"+t,o.setCookie(window.ADS_CPA_CHECKER.cookies.v,o.cpabd_param.v,30,o._domain),o},_CPA.prototype.getUId=function(){var e="-1";try{e=ADM_AdsTracking.get("__uid")}catch(e){}return e},_CPA.prototype.getUIdDomain=function(){var e=-1;try{e=void 0!==(e=localStorage.__uidac)?e:-1}catch(e){}return e},_CPA.prototype.init=function(){var e=this,t=e.cpabd_param,o=e.getParam("cpa_tid"),i=e.getCookie("__tid"),a="",n=e.getCookie("__iid");if("undefined"==i&&(i="",e.setCookie("__tid","",30,e._domain)),""!=o&&(i=o,e.setCookie("__tid",o,30,e._domain),""!=(r=0<(r=parseInt(e.getParam("tpn")))?-1:r)&&e.setCookie("__tpn",r,30,e._domain),""!=(r=e.getParam("ma"))&&null!=r&&e.setCookie("__ma",r,30,e._domain)),(a={query:{source:e.getParam("utm_source"),medium:e.getParam("utm_medium"),campaign:e.getParam("utm_campaign"),content:e.getParam("utm_content")},cookie:this.parseUTMCookie()}).query.source!=a.cookie.source||a.query.medium!=a.cookie.medium||a.query.campaign!=a.cookie.campaign||a.query.content!=a.cookie.content){var d,c="";for(d in a.query)a.query[d]&&(c+=""!=c?"|":"",c+=d+"="+encodeURIComponent(a.query[d]));c&&e.setCookie(window.ADS_CPA_CHECKER.cookies.utm,c,30,e._domain)}var r=0,r="undefined"!=typeof _CPA_CONVERSION_PAGE?_CPA_CONVERSION_PAGE:r;t.tid=i,t.s=void 0!==t.s?t.s:r,t.iid=void 0!==t.iid?t.iid:n,"undefined"!=n&&""!=n||e.setCookie("__iid",t.iid,30,e._domain);t.st=void 0!==t.st?t.st:-1,e.cpabd_param=t},_CPA.prototype.getDomainReferer=function(){var e=this,t=e.getParam("dmn");return""!=t?e.setCookie("__d",t,30,e._domain):t=e.getCookie("__d"),""!=t?t:-1},_CPA.prototype.getParam=function(e){var t="";return(e=new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(location.search))&&(t=decodeURIComponent(e[1])),t},_CPA.prototype.getCookie=function(e){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""},_CPA.prototype.setCookie=function(e,t,o,i){var a=new Date,n=document.location.protocol;switch(a.setDate(a.getDate()+o),n){case"https:":document.cookie=e+"="+escape(t)+(null==o?"":";path=/;domain="+i+";expires="+a.toUTCString()+";secure;SameSite=None"),document.cookie=e+"="+escape(t)+(null==o?"":";path=/;expires="+a.toUTCString()+";secure;SameSite=None");break;case"http:":default:document.cookie=e+"="+escape(t)+(null==o?"":";path=/;domain="+i+";expires="+a.toUTCString()+";SameSite=Strict"),document.cookie=e+"="+escape(t)+(null==o?"":";path=/;expires="+a.toUTCString()+";SameSite=Strict")}},_CPA.prototype.isMobile=function(){var e=window.ADS_CPA_CHECKER.cookies.src;return"MOB"==this.getCookie(e)},_CPA.prototype.getType=function(){var e=parseInt(this.getCookie("__tpn")),t=-1;switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:t=e}return t},_CPA.prototype.getProductType=function(){var e=parseInt(this.getCookie("__tpn"));return 0<e?e:-1},_CPA.prototype.send=function(e){this.isFirefox()&&(e=e.replace(window.ADS_CPA_DOMAIN_DEFAULT,window.ADS_CPA_DOMAINS[window.ADS_CPA_DOMAIN_DEFAULT]));var t=this,o=new Image;o.src=e,o.onerror=function(){e=e.replace(window.ADS_CPA_DOMAIN_DEFAULT,window.ADS_CPA_DOMAINS[window.ADS_CPA_DOMAIN_DEFAULT]),t.send(e)}},_CPA.prototype.start=function(e){var t=this,o=t.cpabd_param,e=void 0===e||1==e?1:0,i="",a=window.ADS_CPA_DOMAIN_DEFAULT,n=this.parseUTMCookie();void 0!==o.iid&&null!=o.iid&&(i=o.iid),""!=i&&t.setCookie("__iid",o.iid,30,t._domain);var d=new RegExp("^[0-9a-zA-Z-]+$");if(""!=o.tid&&0==d.test(o.tid))return!1;o.tid=""==o.tid?"-1":o.tid;d=document.location.href;d=(d=d.replace("&cpa_tid="+o.tid,"")).replace("cpa_tid="+o.tid,"");var c,r="";for(c in n)""!=n[c]&&(r+=r?"&":"",r+="utm_"+c+"="+n[c]);r&&(d=d.replace(/([&]*)utm_[source|medium|campaign|content]+=[^&]+/gim,""),d+=0<=d.indexOf("?")?"&":"?",d+=r);a="https://"+a+"/cpa2"+"?tid="+o.tid+"&path="+encodeURIComponent(d);1==t.getCookie(window.ADS_CPA_CHECKER.cookies.su)&&(o.s=1),void 0!==o.s&&0<=o.s&&(a+="&success="+encodeURIComponent(o.s),t.setCookie(window.ADS_CPA_CHECKER.cookies.su,o.s,30,t._domain));d=t.getCookie(window.ADS_CPA_CHECKER.cookies.v);""!=d&&null!=d&&(o.value=d),void 0!==o.value&&null!=o.value&&null!=i&&(i+="@@@"+o.value.replace(/\t/g," ")),""!=i&&(a+="&iid="+encodeURIComponent(i)),a+="&src="+t.getType(),a+="&ng="+t.getUId(),a+="&sdmn="+t.getDomainReferer(),a+="&dg="+t.getUIdDomain(),1==e&&(1==o.s&&t.setCookie(window.ADS_CPA_CHECKER.cookies.su,"",-30,t._domain),1==o.s&&t.setCookie(window.ADS_CPA_CHECKER.cookies.v,"",-30,t._domain),t.send(a)),1==e&&t.retargetingCreate(o.iid,o.rtg_id,o.value)},_CPA.prototype.setStepValue=function(e){var t=this;return t.cpabd_param.step_value=e,t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,t.cpabd_param.step_value,30,t._domain),t},_CPA.prototype.step=function(e){var t=this,o=t.cpabd_param,e=void 0===e||1==e?1:0,i=t.getCookie(window.ADS_CPA_CHECKER.cookies.st),a=window.ADS_CPA_DOMAIN_DEFAULT,n=this.parseUTMCookie();if(o.st=0<i&&""!=i?i:o.st,0==e)0<(i=void 0!==o.st?o.st:-1)&&t.setCookie(window.ADS_CPA_CHECKER.cookies.st,i,30,t._domain),void 0!==o.step_value&&""!=o.step_value&&t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,o.step_value,30,t._domain);else if(1==e&&0<o.st){new RegExp("^[0-9a-zA-Z-]+$");o.tid=""==o.tid?"-1":o.tid;var d=document.location.href,e="";d=(d=d.replace("&cpa_tid="+o.tid,"")).replace("cpa_tid="+o.tid,"");var c,r="";for(c in n)""!=n[c]&&(r+=r?"&":"",r+="utm_"+c+"="+n[c]);r&&(d=d.replace(/([&]*)utm_[source|medium|campaign|content]+=[^&]+/gim,""),d+=0<=d.indexOf("?")?"&":"?",d+=r);a="https://"+a+"/cpa2"+"?tid="+o.tid+"&path="+encodeURIComponent(d)+"&success=2";void 0!==o.iid&&null!=o.iid&&(e=o.iid);d=t.getCookie(window.ADS_CPA_CHECKER.cookies.sv);""!=d&&null!=d&&(o.step_value=d),void 0!==o.step_value&&null!=o.step_value&&null!=e&&(e+="@@@"+o.step_value.replace(/\t/g," ")),""!=e&&(a+="&iid="+encodeURIComponent(e)),a+="&src="+t.getType(),a+="&sdmn="+t.getDomainReferer(),a+="&dg="+t.getUIdDomain(),a+="&st="+o.st,t.send(a),0<i&&t.setCookie(window.ADS_CPA_CHECKER.cookies.st,"",-30,t._domain),t.setCookie(window.ADS_CPA_CHECKER.cookies.sv,"",-30,t._domain)}},_CPA.prototype.cleanURL=function(e){return e.replace(/[?&]+([^=&]*)[=]*([^&]*)/gi,"")},_CPA.prototype.retargetingCreate=function(e,t,o){if(void 0===e||""==e)return!1;t=void 0===t?0:parseInt(t),t={url:encodeURIComponent(document.location.href),ref:encodeURIComponent(document.referrer),iid:encodeURIComponent(e),tp:encodeURIComponent(this.getProductType()),rtg_id:t,value:void 0!==o&&""!=o?o:-1,ui:this.getUId(),ce:1},o="https://"+window.ADS_CPA_DOMAIN_DEFAULT+"/rtg_bn?url="+t.url+"&rf="+t.ref+"&a="+t.iid+"&b="+t.tp+"&c="+t.rtg_id+"&d="+t.value+"&ui="+t.ui+"&ce="+t.ce;this.isFirefox()&&(t.amcui=this.getCookie("__amcdnuid"),o+="&amcui="+t.amcui),this.send(o)},_CPA.prototype.handlerMessage=function(e){if("object"!=typeof e||"object"!=typeof e.data)return!1;var t=e.data,e=(void 0!==t.type&&t.type,void 0!==t.action?t.action:""),o=void 0!==t.data?t.data:[];if("cpa"===e)try{0<o.length&&window.admq(o)}catch(e){console.log("Post Message Error: ",e)}};var cpabd_param=void 0===cpabd_param?{}:cpabd_param,_cpabd=new _CPA(cpabd_param);_cpabd.init(),_cpabd.start(),_cpabd.step(),_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_iid,_cpabd.cpabd_param.rtg_id),window.addEventListener?window.addEventListener("hashchange",function(){_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_iid,_cpabd.cpabd_param.rtg_id)},!1):window.attachEvent&&window.attachEvent("onhashchange",function(){_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_iid,_cpabd.cpabd_param.rtg_id)},!1),window.addEventListener?window.addEventListener("message",_cpabd.handlerMessage,!1):window.attachEvent("onmessage",_cpabd.handlerMessage);var rs=window.history.replaceState,ps=window.history.pushState;window.history.replaceState=function(){rs.apply(window.history,arguments),_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_iid,_cpabd.cpabd_param.rtg_id)},window.history.pushState=function(){ps.apply(window.history,arguments),_cpabd.retargetingCreate(_cpabd.cpabd_param.rtg_iid,_cpabd.cpabd_param.rtg_id)};
